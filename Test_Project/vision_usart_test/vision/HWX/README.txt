2022年10月9日/23点24分
KEIL5 J_link全速运行自动暂停，是因为keil5版本太高，识别出盗版J_link,
可以通过替换KEILv5/ARM/SEGGER文件夹中的所有文件进行“欺骗”

未解决的问题：云台抖动
问题：在freeRTOS中发送频率不一样导致抖动
TIPS：以后写程序一定要模块化

2022年10月10日/17点13分
模式转换后的PID参数要清零（问题主要集中在底盘）

不要在奇奇怪怪的地方发送数据
内环参数全部都用陀螺仪

角度值没必要进行低通滤波，这样得到的数据会滞后，过零点处理会出大问题。
警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！


数据类型一定要匹配

写函数记得看函数原型

2022年10月11日/11点00分
目前感觉前面的基本没问题，下午上车调一下PID参数应该就完结了
开始写初步的小陀螺模式
1.波妞模式切换
2.底盘的小陀螺模式
3.云台的小陀螺模式

2022年10月13日/21点55分

如何交换两个变量的值，交换两个变量需要几个变量？

警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！
警钟长鸣！！！！！！！！

2022年10月14日/18点11分
开始写拨码轮的位置环和堵转检测

中间两天被隔离整晕了，就当休息了两天吧。

2022年10月17日/10点34分（隔离中）

所以变成了隔离日记？

连发基本完成
单发的位置控制一直有问题 思路：计算总角度和（当数据发生跳变，便记做正转圈数+1 或 -1）
                               上述操作仅在进入单发模式下进行
							   然后检测拨杆跳变
							   每跳变一次，总角度和-8191*4.5 负数是因为要反转
							   
			   目前存在的问题：转过的角度偶尔会不精准，并且会疯
			       可能的原因：单转速度环也不能做到很丝滑的旋转，也会出现一定的卡顿
				   
****************************************************************************************************************				   
！！！！！！！！！！！！！！！！！！！！警钟长鸣！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！

				if(s2_up_flag != 1)
				{
					shoot->stir_wheel->base_info->target_speed = SHOOT_STRI_SPEED;//开启波蛋轮
				}
				else
				{
					shoot->stir_wheel->base_info->target_speed = 0;//关闭波蛋轮
				}
				
由于跳变只有一瞬间，因此一直在运行else语句 对位置环进行操作时，应该及时释放对target_speed的控制
****************************************************************************************************************			   
隔离无法上车，就先写一下



连发堵转 思路：转不动就反转
要增加一个判断是否在初始化的标志位，应到拨码轮到达指定速度之后再开启堵转检测
还要增加一个表示是否在进行堵转处理的标志位，判断谁对拨码轮的目标速度有处理权


单发堵转 思路：对位置环进行操作，发生一个小范围的抖动？
增加一个堵转次数标志位，当这个数字为偶数，代表需要反转
                                  为奇数，代表需要正传
反转即对位置环有一个小小的 +5000
正传同理

主要还是对堵转状态的判断和对正反转的处理（不过单发位置环都还没解决就别整这些了）

2022年10月17日/11点34分
写一下之前一直拖着的换头，主要是在spin模式下切换到follow时，需要进行的一个处理
思路：在进入切换模式时，无需判断一下上次是什么模式,直接在follow中处理就好，则判断当前云台角度，将机械中止更改为6100
                                                                                               并反向遥控器传入的数据
																							   只需要反转前后左右，且只需反转跟随模式的
																							   GOOD IEAD : 标志位用正负1表示，要在需要需要换头判断正反的地方乘上标志位就好

云台还有点小问题： 进入follow时，头会转动
问题：因为机械模式下的target_angle是6020的数据，而切换成follow后就变成了陀螺仪的数据，因此去到了陀螺仪的2100；
思路：在第一次进入follo时，将目标值设为当前陀螺的角度
增加一个第一次进入陀螺的标志位。并且在其他模式下清零(仅仅在G_Y_lock 中更新标志位)

2022年10月17日/12点14分 吃饭了 					


2022年10月21日/00点32分
看看crc8和crc16，睡啦，明天再来写啥的

2022年10月21日/10点36分
回实验室待测试代价：1.换头 2.换成角度差分的单发 3.连发堵转 4.模式切换底盘是否还会动


在chassis gimbal car 中增加了vision_CAR的模式切换,底盘直接接入机械模式下的底盘
                                                  云台还未接入视觉的数据
VISION中增加了收发数据的函数，难道不是中断接收数据？

接下来写数据更新的函数


2022年10月23日/20点46分
记得开DMA(开全局中断)，UART3

小陀螺模式也是跟随旗下的所以也是要用陀螺仪


接下来几天的目标：

角速度矫正计算(finish 但 用上之后会特别抖 可能要调一调PID)(或许可以自己更新bmi的解算，放到以后再说吧)
视觉联动(finish 但 PID有待提升)
舵机代码(finish 能开 但是值不知道为什么和zs不一样)
PITCH轴的模式切换主要是陀螺仪与电机角度的切换 就是跟随和机械的切换 还有视觉和跟随和视觉的切换(finish )
测试模式切换功能：底盘和云台都要(这个基本也解决了)
测试模式切换头的问题(基本解决)

进小陀螺pitch会动(解决了)

测试单发，测试连发堵转(我看见这个就头疼)

第一次遥控器连接底盘不乱动 思路：判断假设遥控器从offline立马切换到follow 
								 那么，就立刻让头的目标值等于2100
								 。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。
								 写那么复杂干嘛，不就是为了跟随模式上电不乱动吗，那就只有进入了机械才能操作
								 
2022年10月25日/18点43分 
今晚学习任务：
大物实验预习，打印复变函数作业，完成大物小测。


好像是因为 速度值会出现一个很大的跳变，就导致误差突然变大： 是因为CAN1和CAN2的接收数据没有分开


改一下CAN的收发(改好了)

只有在小陀螺模式开启才换头检测

摩擦轮和波蛋轮优先级

键盘的模式切换

快速换头的头不能动。

机械切换小陀螺头会动

机械模式下按的C不能起作用








